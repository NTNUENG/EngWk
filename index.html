<!DOCTYPE html>
<html lang="zh-tw">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>前臺｜國立臺灣師範大學英語學系 2024 聖誕英語週點餐系統</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Mono:wdth,wght@75,100..900&display=swap" rel="stylesheet">
    <link rel="stylesheet" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/misans@4.0.0/lib/TC/MisansTC-Normal.min.css" />
    <link rel="stylesheet" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/misans@4.0.0/lib/TC/MisansTC-Bold.min.css" />
    <link rel="stylesheet" href="stylesheets/style.css">
    <link rel="stylesheet" href="stylesheets/_accordion.css">
    <link rel="stylesheet" href="stylesheets/_switch.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,400,0,0" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.form/4.2.2/jquery.form.min.js" integrity="sha256-2Pjr1OlpZMY6qesJM68t2v39t+lMLvxwpa8QlRjJroA=" crossorigin="anonymous"></script>
    <script src="js/anchyuen.js"></script>
    <script>
    </script>
    <style>
        html {
            -webkit-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        h2 {
            display: flex;
        }

        sub {
            vertical-align: baseline;
            font-size: 70%;
            padding-left: 0.25em;
            opacity: 70%;
        }

            sub.badge {
                font-size: 70%;
                margin-left: 0.25em;
                opacity: 1;
            }

        input {
            width: 100%;
            border: 1px solid transparent;
            background-color: var(--surface);
            border-radius: calc(var(--gap) * 0.5);
            font-size: 1rem;
            line-height: 2rem;
            color: inherit;
            outline: none;
            text-align: inherit;
            transition: border 0.2s ease, box-shadow 0.2s ease, border-radius 0.2s ease, background-color 0.2s ease;
        }

            input[type=number], input[type=tel] {
                font-family: var(--monospace);
            }

            input[type=number] {
                border: 1px solid var(--border);
                -moz-appearance: textfield;
                appearance: textfield;
            }

            input:not([type=btn]):focus {
                border-radius: calc(var(--gap) * 0.2);
                box-shadow: 0 0 calc(var(--gap) * 0.5) var(--border);
            }

            input[type=number]::-webkit-inner-spin-button,
            input[type=number]::-webkit-outer-spin-button {
                -webkit-appearance: none;
            }

            input:hover {
                box-shadow: 0 0 calc(var(--gap) * 0.5) var(--border);
            }

            input:invalid {
                border: 1px solid transparent;
                border-radius: 0;
                box-shadow: 0 0 calc(var(--gap) * 0.5) var(--error);
                background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 12 12' width='12' height='12' fill='none' stroke='%23dc3545'%3e%3ccircle cx='6' cy='6' r='4.5'/%3e%3cpath stroke-linejoin='round' d='M5.8 3.6h.4L6 6.5z'/%3e%3ccircle cx='6' cy='8.2' r='.6' fill='%23dc3545' stroke='none'/%3e%3c/svg%3e");
                background-repeat: no-repeat;
                background-position: right calc(.375em + .1875rem) center;
                background-size: calc(.75em + .375rem) calc(.75em + .375rem);
            }

        .container .quantity {
            display: flex;
            flex-direction: row;
        }

            .container .quantity .material-symbols-rounded {
                cursor: pointer;
                background-color: var(--surface);
                min-width: 2rem;
                line-height: 2rem;
                font-size: 1em;
                border: 1px solid var(--border);
                transition: background-color 0.2s ease;
            }

                .container .quantity .material-symbols-rounded:hover {
                    background-color: #dcdace;
                }

            .container .quantity .less {
                border-radius: calc(var(--gap) * 0.5) 0 0 calc(var(--gap) * 0.5);
                border-right: none;
            }

            .container .quantity .more {
                border-radius: 0 calc(var(--gap) * 0.5) calc(var(--gap) * 0.5) 0;
                border-left: none;
            }

            .container .quantity input {
                border-radius: 0;
                background-color: transparent;
                margin-top: auto;
                z-index: 2;
            }

                .container .quantity input[type=number]:focus {
                    background-color: var(--surface);
                }

        fieldset {
            text-align: center;
            display: flex;
            flex-direction: column;
        }

            fieldset h2 {
                text-align: left;
            }

        legend {
            display: none;
        }

        .label {
            margin-bottom: calc(var(--gap) * 0.5);
        }

            .label .price {
                font-family: var(--monospace);
                font-size: 70%;
                opacity: 70%;
                color: var(--primary);
            }

        .badge {
            cursor: pointer;
            font-size: 50%;
            margin-left: auto;
            font-weight: normal;
            border-radius: 10px;
            padding: 0.25rem;
            align-self: center;
            line-height: 1rem;
            transition: box-shadow 0.2s ease;
        }

        .jumpTo {
            cursor: pointer;
            padding: 0 0.2rem;
            margin: 0.2rem;
            border-radius: 10px;
            text-decoration: underline dotted;
            transition: box-shadow 0.2s ease;
        }

            .badge.discount, .jumpTo.discount {
                background-color: #bdecde7b;
                color: #3b665b;
            }

            .badge.art, .jumpTo.art {
                background-color: #ecbde07a;
                color: #663b65;
            }

            .badge:hover, .jumpTo:hover {
                box-shadow: 0 0 calc(var(--gap) * 0.5) var(--border);
            }

        .cardHolder {
            display: flex;
            flex-direction: row;
            margin-top: 1em;
        }

            .cardHolder .card {
                flex: 1 1 auto;
                padding: calc(var(--gap) * 0.5);
                min-width: 10em;
            }

                .cardHolder .card p:first-child {
                    font-weight: bold;
                }

                .cardHolder .card p:last-child {
                    font-size: 80%;
                }

        .used {
            border: 1px dotted var(--border);
            margin-top: 0.5em;
        }

            .used .material-symbols-rounded {
                vertical-align: middle;
            }
    </style>
</head>

<body>
    <div class="blurred-bg"></div>

    <form action="https://docs.google.com/forms/d/e/1FAIpQLSf-A4ReWwACpnJNrCWcpBdo2z2KgOrQSVv16Jr0RHKEY4_S2g/formResponse"
          target="_self"
          id="bootstrapForm"
          method="POST">

        <div class="header" id="top">
            <h1>聖誕英語週點餐系統前臺</h1>

            <!-- Field type: "short" id: "1028344047" -->
            <fieldset style="display: block">
                <legend for="1028344047">收銀員</legend>
                <input id="1726360308" style="width: min(calc(var(--gap) * 20), 80dvw);" type="text" name="entry.1726360308" placeholder="收銀員華文姓名" required readonly>
            </fieldset>

            <div id="input-group" style=" display: flex; justify-content: center;">
                <!-- Field type: "short" id: "71287061" -->
                <fieldset>
                    <legend for="71287061">ID-num</legend>
                    <div class="form-group">
                        <input id="780771985" style="width: min(calc(var(--gap) * 10), 40dvw); border-top-right-radius: 0px; border-bottom-right-radius: 0px; clip-path: inset(-10px 0px -10px -10px);" type="tel" name="entry.780771985" placeholder="客戶末三碼" pattern="[0-9]{3}" required>
                    </div>
                </fieldset>


                <!-- Field type: "short" id: "762479566" -->
                <fieldset>
                    <legend for="762479566">ID-surname</legend>
                    <div class="form-group">
                        <input id="553056708" style="width: min(calc(var(--gap) * 10), 40dvw); border-top-left-radius: 0px; border-bottom-left-radius: 0px; clip-path: inset(-10px -10px -10px 0px);" type="text" name="entry.553056708" placeholder="客戶姓氏" required>
                    </div>
                </fieldset>
            </div>
        </div>

        <div class="container" id="ry">
            <!-- Field type: "section" id: "854395890" -->
            <fieldset style="display: block;">
                <h2 for="854395890">時間暫停熱壓吐司<span class="badge discount" onclick="jumpTo('discountInfo', 'taotsan-acc')">組合套餐</span></h2>
            </fieldset>

            <div class="menu">
                <!-- Field type: "short" id: "788998900" -->
                <fieldset>
                    <legend for="788998900">ㄖㄧ奶酥</legend>
                    <div class="label">奶酥<div class="price">25$</div></div>
                    <div class="quantity">
                        <span class="less material-symbols-rounded">remove</span>
                        <input id="1293379201" type="number" name="entry.1293379201" placeholder="0" data-name="時間暫停熱壓吐司・奶酥" min="0" data-price="25">
                        <span class="more material-symbols-rounded">add</span>
                    </div>
                </fieldset>

                <!-- Field type: "short" id: "282590697" -->
                <fieldset>
                    <legend for="282590697">ㄖㄧ香蒜</legend>
                    <div class="label">香蒜<div class="price">30$</div></div>
                    <div class="quantity">
                        <span class="less material-symbols-rounded">remove</span>
                        <input id="1152234688" type="number" name="entry.1152234688" placeholder="0" data-name="時間暫停熱壓吐司・香蒜" min="0" data-price="30">
                        <span class="more material-symbols-rounded">add</span>
                    </div>
                </fieldset>

                <!-- Field type: "short" id: "224487495" -->
                <fieldset>
                    <legend for="224487495">ㄖㄧ巧克力</legend>
                    <div class="label">巧克力棉花糖<div class="price">30$</div></div>
                    <div class="quantity">
                        <span class="less material-symbols-rounded">remove</span>
                        <input id="312838004" type="number" name="entry.312838004" placeholder="0" data-name="時間暫停熱壓吐司・巧克力棉花糖" min="0" data-price="30">
                        <span class="more material-symbols-rounded">add</span>
                    </div>
                </fieldset>

                <!-- Field type: "short" id: "1704765215" -->
                <fieldset>
                    <legend for="1704765215">ㄖㄧ火腿</legend>
                    <div class="label">火腿起司<div class="price">35$</div></div>
                    <div class="quantity">
                        <span class="less material-symbols-rounded">remove</span>
                        <input id="219553379" type="number" name="entry.219553379" placeholder="0" data-name="時間暫停熱壓吐司・火腿起司" min="0" data-price="35">
                        <span class="more material-symbols-rounded">add</span>
                    </div>
                </fieldset>
            </div>
        </div>

        <div class="container" id="et">
            <!-- Field type: "section" id: "1082036472" -->
            <fieldset style="display: block;">
                <h2 for="1082036472">撲克牌武士小蛋糕<span class="badge discount" onclick="jumpTo('discountInfo', 'taotsan-acc')">組合套餐</span></h2>
            </fieldset>

            <div class="menu">
                <!-- Field type: "short" id: "397234414" -->
                <fieldset>
                    <legend for="397234414">ㄧㄉOreo</legend>
                    <div class="label">黑桃<span class="hanLatin">♠️</span><sub>Oreo</sub><div class="price">35$</div></div>
                    <div class="quantity">
                        <span class="less material-symbols-rounded">remove</span>
                        <input id="2110937824" type="number" name="entry.2110937824" placeholder="0" data-name="撲克牌武士小蛋糕・黑桃武士" min="0" data-price="35">
                        <span class="more material-symbols-rounded">add</span>
                    </div>
                </fieldset>

                <!-- Field type: "short" id: "924501392" -->
                <fieldset>
                    <legend for="924501392">ㄧㄉ草莓</legend>
                    <div class="label">紅心<span class="hanLatin">♥️</span><sub>草莓果醬＋果乾</sub><div class="price">40$</div></div>
                    <div class="quantity">
                        <span class="less material-symbols-rounded">remove</span>
                        <input id="2078319371" type="number" name="entry.2078319371" placeholder="0" data-name="撲克牌武士小蛋糕・紅心武士" min="0" data-price="40">
                        <span class="more material-symbols-rounded">add</span>
                    </div>
                </fieldset>

                <!-- Field type: "short" id: "1436610486" -->
                <fieldset>
                    <legend for="1436610486">ㄧㄉ巧克力</legend>
                    <div class="label">方塊<span class="hanLatin">♦️</span><sub>巧克力醬＋棉花糖</sub><div class="price">35$</div></div>
                    <div class="quantity">
                        <span class="less material-symbols-rounded">remove</span>
                        <input id="476499688" type="number" name="entry.476499688" placeholder="0" data-name="撲克牌武士小蛋糕・方塊武士" min="0" data-price="35">
                        <span class="more material-symbols-rounded">add</span>
                    </div>
                </fieldset>

                <!-- Field type: "short" id: "1608265025" -->
                <fieldset>
                    <legend for="1608265025">ㄧㄉ抹茶</legend>
                    <div class="label">梅花<span class="hanLatin">♣️</span><sub>抹茶紅豆</sub><div class="price">40$</div></div>
                    <div class="quantity">
                        <span class="less material-symbols-rounded">remove</span>
                        <input id="1432997229" type="number" name="entry.1432997229" placeholder="0" data-name="撲克牌武士小蛋糕・梅花武士" min="0" data-price="40">
                        <span class="more material-symbols-rounded">add</span>
                    </div>
                </fieldset>
            </div>
        </div>

        <div class="container" id="dr">
            <!-- Field type: "section" id: "1720670259" -->
            <fieldset style="display: block;">
                <h2 for="1720670259">暖心飲品<span class="badge discount" onclick="jumpTo('discountInfo', 'taotsan-acc')">組合套餐</span></h2>
            </fieldset>

            <div class="menu">
                <!-- Field type: "short" id: "146021213" -->
                <fieldset>
                    <legend for="146021213">ㄧㄌ可可</legend>
                    <div class="label">瘋帽客可可<div class="price">30$</div></div>
                    <div class="quantity">
                        <span class="less material-symbols-rounded">remove</span>
                        <input id="576114498" type="number" name="entry.576114498" placeholder="0" data-name="暖心飲品・瘋帽客可可" min="0" data-price="30">
                        <span class="more material-symbols-rounded">add</span>
                    </div>
                </fieldset>

                <!-- Field type: "short" id: "528786601" -->
                <fieldset>
                    <legend for="528786601">ㄧㄌ棉花糖</legend>
                    <div class="label">瘋帽客可可<sub>＋棉花糖</sub><div class="price">35$</div></div>
                    <div class="quantity">
                        <span class="less material-symbols-rounded">remove</span>
                        <input id="1436805870" type="number" name="entry.1436805870" placeholder="0" data-name="暖心飲品・瘋帽客可可＋" min="0" data-price="35">
                        <span class="more material-symbols-rounded">add</span>
                    </div>
                </fieldset>

                <!-- Field type: "short" id: "301739864" -->
                <fieldset>
                    <legend for="301739864">ㄧㄌ奶茶</legend>
                    <div class="label">白兔奶茶<div class="price">30$</div></div>
                    <div class="quantity">
                        <span class="less material-symbols-rounded">remove</span>
                        <input id="362036548" type="number" name="entry.362036548" placeholder="0" data-name="暖心飲品・白兔奶茶" min="0" data-price="30">
                        <span class="more material-symbols-rounded">add</span>
                    </div>
                </fieldset>

                <!-- Field type: "short" id: "506716195" -->
                <fieldset>
                    <legend for="506716195">ㄧㄌ咖啡</legend>
                    <div class="label">苦澀寫字檯咖啡<div class="price">30$</div></div>
                    <div class="quantity">
                        <span class="less material-symbols-rounded">remove</span>
                        <input id="3695229" type="number" name="entry.3695229" placeholder="0" data-name="暖心飲品・苦澀寫字檯咖啡" min="0" data-price="30">
                        <span class="more material-symbols-rounded">add</span>
                    </div>
                </fieldset>

                <!-- Field type: "short" id: "1721585757" -->
                <fieldset>
                    <legend for="1721585757">ㄧㄌ紅茶</legend>
                    <div class="label">紅心皇后皇家紅茶<div class="price">30$</div></div>
                    <div class="quantity">
                        <span class="less material-symbols-rounded">remove</span>
                        <input id="263894104" type="number" name="entry.263894104" placeholder="0" data-name="暖心飲品・紅心皇后皇家紅茶" min="0" data-price="30">
                        <span class="more material-symbols-rounded">add</span>
                    </div>
                </fieldset>

                <!-- Field type: "short" id: "607958717" -->
                <fieldset>
                    <legend for="607958717">ㄧㄌ蘑菇</legend>
                    <div class="label">艾瑟隆迷幻蘑菇濃湯<div class="price">45$</div></div>
                    <div class="quantity">
                        <span class="less material-symbols-rounded">remove</span>
                        <input id="22730490" type="number" name="entry.22730490" placeholder="0" data-name="暖心飲品・艾瑟隆迷幻蘑菇濃湯" min="0" data-price="45">
                        <span class="more material-symbols-rounded">add</span>
                    </div>
                </fieldset>
            </div>
        </div>

        <div class="container" id="ar">
            <!-- Field type: "section" id: "525883564" -->
            <fieldset style="display: block;">
                <h2 for="525883564">文創商品</h2>
            </fieldset>

            <div class="menu">
                <!-- Field type: "short" id: "930259876" -->
                <fieldset>
                    <legend for="930259876">ㄇㄒ貼紙</legend>
                    <div class="label">貼紙<sub class="badge art" onclick="jumpTo('discountInfo', 'art-acc')">越買越省</sub><div class="price">15$</div></div>
                    <div class="quantity">
                        <span class="less material-symbols-rounded">remove</span>
                        <input id="1485386383" type="number" name="entry.1485386383" placeholder="0" data-name="文創商品・貼紙" min="0" data-price="15">
                        <span class="more material-symbols-rounded">add</span>
                    </div>
                </fieldset>

                <!-- Field type: "short" id: "261692789" -->
                <fieldset>
                    <legend for="261692789">ㄇㄒ明信片</legend>
                    <div class="label">明信片<sub class="badge art" onclick="jumpTo('discountInfo', 'art-acc')">越買越省</sub><div class="price">25$</div></div>
                    <div class="quantity">
                        <span class="less material-symbols-rounded">remove</span>
                        <input id="1866350321" type="number" name="entry.1866350321" placeholder="0" data-name="文創商品・明信片" min="0" data-price="25">
                        <span class="more material-symbols-rounded">add</span>
                    </div>
                </fieldset>

                <!-- Field type: "short" id: "1392899267" -->
                <fieldset>
                    <legend for="1392899267">ㄇㄒ徽章</legend>
                    <div class="label">徽章<div class="price">40$</div></div>
                    <div class="quantity">
                        <span class="less material-symbols-rounded">remove</span>
                        <input id="1529285761" type="number" name="entry.1529285761" placeholder="0" data-name="文創商品・徽章" min="0" data-price="40">
                        <span class="more material-symbols-rounded">add</span>
                    </div>
                </fieldset>

                <!-- Field type: "short" id: "407652816" -->
                <fieldset>
                    <legend for="407652816">ㄇㄒ吊飾</legend>
                    <div class="label">吊飾<div class="price">45$</div></div>
                    <div class="quantity">
                        <span class="less material-symbols-rounded">remove</span>
                        <input id="1631742395" type="number" name="entry.1631742395" placeholder="0" data-name="文創商品・吊飾" min="0" data-price="45">
                        <span class="more material-symbols-rounded">add</span>
                    </div>
                </fieldset>

                <!-- Field type: "short" id: "1063157919" -->
                <fieldset>
                    <legend for="1063157919">ㄇㄒ檔案夾</legend>
                    <div class="label">資料夾<div class="price">55$</div></div>
                    <div class="quantity">
                        <span class="less material-symbols-rounded">remove</span>
                        <input id="729785754" type="number" name="entry.729785754" placeholder="0" data-name="文創商品・資料夾" min="0" data-price="55">
                        <span class="more material-symbols-rounded">add</span>
                    </div>
                </fieldset>


                <!-- Field type: "short" id: "481329278" -->
                <fieldset>
                    <legend for="481329278">ㄇㄒ系服</legend>
                    <div class="label">系服<div class="price">340$</div></div>
                    <div class="quantity">
                        <span class="less material-symbols-rounded">remove</span>
                        <input id="262762365" type="number" name="entry.262762365" placeholder="0" data-name="文創商品・系服" min="0" data-price="340">
                        <span class="more material-symbols-rounded">add</span>
                    </div>
                </fieldset>
            </div>
        </div>

        <div class="container fullscreen flex" id="discountInfo">
            <!-- Field type: "section" id: "1274859049" -->
            <fieldset>
                <legend for="1274859049">clerk only area</legend>
                <div class="form-group">
                </div>
            </fieldset>
            <h2 for="525883564">優惠方案</h2>
            <div class="accordion">
                <div class="accordion-item">
                    <button class="accordion-button" type="button" id="taotsan-acc">組合套餐</button>
                    <div class="accordion-panel">
                        <div class="accordion-body">
                            凡購買「<span class="jumpTo discount" onclick="jumpTo('ry')">時間暫停熱壓吐司</span>」或「<span class="jumpTo discount" onclick="jumpTo('et')">撲克牌武士小蛋糕</span>」搭配「<span class="jumpTo discount" onclick="jumpTo('dr')">暖心飲品</span>」者，每組合折<span class="hanLatin">5</span>元。
                            <div class="used hidden" id="taotsan-holder">
                                <span class="material-symbols-rounded">check</span>已購買<span class="hanLatin" id="taotsan-quantity">1</span>組，折價<span class="hanLatin" id="taotsan-discount">5</span>元。
                            </div>
                        </div>
                    </div>
                </div>
                <div class="accordion-item">
                    <button class="accordion-button" type="button" id="art-acc">越買越省</button>
                    <div class="accordion-panel">
                        <div class="accordion-body">
                            購買部分「<span class="jumpTo art" onclick="jumpTo('ar')">文創商品</span>」可享有價格優惠。
                            <div class="cardHolder">
                                <div class="card">
                                    <p>貼紙</p>
                                    <p>第<span class="hanLatin">5</span>張起此商品全面六六折，即<span class="hanLatin">10</span>元。</p>
                                </div>
                                <div class="card">
                                    <p>明信片</p>
                                    <p>自選<span class="hanLatin">5</span>張為一組，每組優惠價<span class="hanLatin">110</span>元，多出者以原價計算。</p>
                                </div>
                            </div>
                            <div class="used hidden" id="sticker-holder">
                                <span class="material-symbols-rounded">check</span>已購買<span class="hanLatin" id="sticker-quantity">5</span>張貼紙，共省下<span class="hanLatin" id="sticker-discount">15</span>元。
                            </div>
                            <div class="used hidden" id="postcard-holder">
                                <span class="material-symbols-rounded">check</span>已購買<span class="hanLatin" id="postcard-quantity">1</span>組明信片，共省下<span class="hanLatin" id="postcard-discount">5</span>元。
                            </div>
                        </div>
                    </div>
                </div>
                <div class="accordion-item">
                    <button class="accordion-button" type="button">打卡轉盤</button>
                    <div class="accordion-panel">
                        <div class="accordion-body">
                            消費並打卡「@英語週帳號 #喝我 #吃我 #英語週slogan」即享有「轉盤」機會乙次。
                            <div class="used">
                                <!-- Field type: "checkboxes" id: "1349133076" -->
                                <fieldset style="display: flex;flex-direction: row;align-items: center;">
                                    <legend for="1349133076">coaDakah</legend>
                                    <label class="switch" style="margin: 0.25em;">
                                        <input id="1143116670" type="checkbox" name="entry.1143116670" value="yes">
                                        <span class="slider round"></span>
                                    </label>
                                    <label for="1143116670">顧客是否已打卡，且轉盤獲得「當次折價」？</label>
                                </fieldset>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="accordion-item">
                    <button class="accordion-button" type="button">紅心遊戲</button>
                    <div class="accordion-panel">
                        <div class="accordion-body">
                            消費滿百即享有遊戲機會，每單以乙次為限。
                            <div class="cardHolder">
                                <div class="card">
                                    <p>紅心皇后的槌球場</p>
                                    <p>成功擲桌球入杯中即可獲得杯底所示獎勵，未投進者不予重試。</p>
                                </div>
                                <div class="card">
                                    <p>紅心背叛者</p>
                                    <p>自由<span class="hanLatin">4</span>張<span class="hanLatin">Q</span>及<span class="hanLatin">1</span>張鬼牌組成的牌堆中抽牌，抽獲<span class="hanLatin">Q</span>者贈送公關品，鬼牌則為英語週折價券。</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="accordion-item">
                    <button class="accordion-button" type="button">英語週折價券</button>
                    <div class="accordion-panel">
                        <div class="accordion-body">
                            使用此券即可折價<span class="hanLatin">5</span>元。請注意，英語週折價券不可當次獲得即使用，須待來次主動於結帳前使用之，且每單以乙張為限。
                            <div class="used" id="sticker-holder">
                                <!-- Field type: "short" id: "998956529" -->
                                <fieldset>
                                    <legend for="998956529">coaCoupon</legend>
                                    <input id="331688563" type="text" name="entry.331688563" placeholder="請輸入折價券代碼" pattern="ENG-[0-9]{3}-[0-9]{4}" style="font-family: var(--monospace)">
                                </fieldset>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!--<div style="flex: 1 1 auto"></div>-->
            <div class="centre" style="margin-top: auto">
                <div id="total" style="font-size: 2em; font-weight: bold; margin-top: var(--gap);">總金額：0 元</div>
                <input class="btn" type="button" value="重新" onclick="resetInputs()" style="background: #ffdad6; color: #410002; font-weight: bold; margin-top: calc(var(--gap) * 0.5);">
                <input class="btn hidden" type="submit" value="提交" id="submit-button" style="background: #ddea96; color: #191e00; font-weight: bold; margin-top: calc(var(--gap) * 0.5);" disabled>
            </div>
        </div>

        <div class="container receipt" id="receipt">
            <h2>收據</h2>
            <div id="recipient" class="orderID"><span class="hanLatin"></span><span id="receipt-time"></span></div>
            <div id="receipt-table">
            </div>
            <div id="total-receipt"></div>
        </div>

        <input type="hidden" name="fvv" value="1">
        <input type="hidden" name="fbzx" value="-6922683474843098141">
        <!--
        CAVEAT: In multipages (multisection) forms, *pageHistory* field tells to google what sections we've currently completed.
        This usually starts as "0" for the first page, then "0,1" in the second page... up to "0,1,2..N" in n-th page.
        Keep this in mind if you plan to change this code to recreate any sort of multipage-feature in your exported form.
        We're setting this to the total number of pages in this form because we're sending all fields from all the section together.
    -->
        <input type="hidden" name="pageHistory" value="0,1,2,3,4,5">
    </form>
    <script src="js/_accordion.js"></script>
    <script>//
        const form = document.getElementById('bootstrapForm');
        const clerkInput = document.getElementById('1726360308');
        const totalElement = document.getElementById('total');
        const submitButton = document.getElementById('submit-button');
        const receipt = document.getElementById('receipt');
        const receiptItems = document.getElementById('receipt-table');
        const totalReceipt = document.getElementById('total-receipt');

        const taotsanHolder = document.getElementById('taotsan-holder');
        const taotsanQuantity = document.getElementById('taotsan-quantity');
        const taotsanDiscount = document.getElementById('taotsan-discount');
        const stickerHolder = document.getElementById('sticker-holder');
        const stickerQuantity = document.getElementById('sticker-quantity');
        const stickerDiscount = document.getElementById('sticker-discount');
        const stickerInput = document.getElementById('1485386383');
        const postcardHolder = document.getElementById('postcard-holder');
        const postcardQuantity = document.getElementById('postcard-quantity');
        const postcardDiscount = document.getElementById('postcard-discount');
        const postcardInput = document.getElementById('1866350321');
        const dakahInput = document.getElementById('1143116670');


        form.addEventListener('input', updateTotal);

        let couponKeyValid = false;

        let arrayName = new Array();
        let arrayQuantity = new Array();
        let arrayPrice = new Array();
        let arrayPxQ = new Array();

        let total = 0;
        let boughtRuhyah = 0;
        let boughtEton = 0;
        let boughtDrinks = 0;
        let boughtStickers = 0;
        let boughtPosrcards = 0;
        let discountA = 0;
        let discountB = 0;
        let discountSticker = 0;
        let discountPostcard = 0;

        resetVariables();

        function resetVariables() {
            receipt.style.display = 'none';
            receiptItems.innerHTML = '';
            arrayName = new Array();
            arrayQuantity = new Array();
            arrayPrice = new Array();
            arrayPxQ = new Array();
            total = 0;
            boughtRuhyah = 0;
            boughtEton = 0;
            boughtDrinks = 0;
            discountAB = 0;
            discountSticker = 0;
            discountPostcard = 0;
            updateTotal();
        }

        function resetInputs() {
            document.getElementById('top').scrollIntoView({ behavior: 'smooth' });

            form.querySelectorAll('input[type="number"]').forEach(input => {
                input.value = '';
            });
            document.getElementById('780771985').value = '';
            document.getElementById('553056708').value = '';
            document.getElementById('1143116670').checked = false;
            document.getElementById('331688563').value = '';
            resetVariables();
            loadCoupons();
        }

        function countDiscountSet(type) {
            let discountTimes = 0;
            const inputs = form.querySelectorAll(`#${type} input[type="number"]`);
            inputs.forEach(input => {
                const quantity = input.value || 0;
                if (quantity > 0) {
                    discountTimes += parseInt(quantity);
                }
            });
            return discountTimes;
        }

        function updateTotal() {
            total = 0;
            boughtRuhyah = countDiscountSet('ry');
            boughtEton = countDiscountSet('et');
            boughtDrinks = countDiscountSet('dr');
            discountAB = Math.min(boughtRuhyah + boughtEton, boughtDrinks);

            const inputs = form.querySelectorAll('input[type="number"]');
            inputs.forEach(input => {
                const quantity = input.value || 0;
                if (quantity > 0) {
                    const name = input.dataset.name;
                    const price = input.dataset.price;
                    total += price * quantity;
                }
            });

            if (discountAB > 0) {
                const deduct = discountAB * 5;
                total -= deduct;

                taotsanQuantity.textContent = discountAB;
                taotsanDiscount.textContent = deduct;
            }
            switchView(taotsanHolder, discountAB > 0);

            boughtStickers = parseInt(stickerInput.value);
            if (boughtStickers > 4) {
                discountSticker = boughtStickers * 5;
                total -= discountSticker;

                stickerQuantity.textContent = boughtStickers;
                stickerDiscount.textContent = discountSticker;
            }
            switchView(stickerHolder, boughtStickers > 4);

            //(100 - ((deduct / (boughtStickers * stickerInput.dataset.price)) * 100)).toString().split('.')[0].replaceAll('0', '').replaceAll('1', '一').replaceAll('2', '二').replaceAll('3', '三').replaceAll('4', '四').replaceAll('5', '五').replaceAll('6', '六').replaceAll('7', '七').replaceAll('8', '八').replaceAll('9', '九');

            boughtPostcards = parseInt(postcardInput.value);
            if (boughtPostcards > 4) {
                discountPostcard = ~~(boughtPostcards / 5) * 15;
                total -= discountPostcard;

                postcardQuantity.textContent = ~~(boughtPostcards / 5);
                postcardDiscount.textContent = discountPostcard;
            }
            switchView(postcardHolder, boughtPostcards > 4);

            if (dakahInput.checked)
                total -= 5;

            if (couponKeyValid)
                total -= 5;

            totalElement.innerHTML = `共<span class="priceTag">${Math.max(total, 0)}</span>元`;

            switchView(submitButton, total > 0 && couponKeyValid);
            submitButton.disabled = total <= 0 && !couponKeyValid;

            resizeOpenAccordion();
        }

        function pushReceiptItem(n, q, p) {
            arrayName.push(n);
            arrayQuantity.push(q);
            arrayPrice.push(p);
            arrayPxQ.push(p * q);
        }

        function displayReceipt() {
            resetVariables();
            console.log(total);

            const inputs = form.querySelectorAll('input[type="number"]');
            inputs.forEach(input => {
                const quantity = parseInt(input.value) || 0;
                if (quantity > 0) {
                    let name = input.dataset.name;
                    let price = parseInt(input.dataset.price);

                    if (input.id === '1485386383' && quantity > 4) { // Stickers
                        name += '（六六折）';
                        price = 10;
                    }
                    else if (input.id === '1866350321' && quantity > 4) { // Postcards
                        if (quantity % 5 > 0) {
                            pushReceiptItem(name, quantity % 5, price);
                        }

                        pushReceiptItem(name + '（組）', ~~(boughtPostcards / 5), 110);

                        return;
                    }

                    pushReceiptItem(name, quantity, price);
                }
            });

            if (discountAB > 0) {
                arrayName.push('優惠方案・套餐');
                arrayQuantity.push(discountAB);
                arrayPrice.push(-5);
                arrayPxQ.push(discountAB * -5);
            }

            if (dakahInput.checked) {
                arrayName.push('優惠方案・打卡轉盤折扣');
                arrayQuantity.push(1);
                arrayPrice.push(-5);
                arrayPxQ.push(-5);
            }

            const couponInput = document.getElementById('331688563');

            if (couponKeyValid && couponInput.value.trim().length != 0) {
                arrayName.push('優惠方案・英語週優惠券');
                arrayQuantity.push(1);
                arrayPrice.push(-5);
                arrayPxQ.push(-5);

                useNewCoupon(couponInput.value.trim());
            }

            document.getElementById('recipient').innerHTML = `＃<span class="hanLatin" style="padding-left: 0;">${document.getElementById('780771985').value}</span>${document.getElementById('553056708').value}｜<span id="receipt-time"></span>`

            const date = new Date();
            const youbi = ['日', '一', '二', '三', '四', '五', '六'];
            document.getElementById('receipt-time').innerHTML = `中華民國<span class="hanLatin">${date.getFullYear() - 1911}</span>年<span class="hanLatin">${date.getMonth() + 1}</span>月<span class="hanLatin">${date.getDate()}</span>日<span class="hanLatin">${date.getHours()}</span>時<span class="hanLatin">${date.getMinutes()}</span>分<span class="hanLatin">${date.getSeconds()}</span>秒｜${clerkInput.value}`;

            receiptItems.insertAdjacentHTML('afterbegin', createTable());
            receipt.style.display = 'block';
            receipt.scrollIntoView({ behavior: 'smooth' });

            //totalElement.textContent = `總金額：0 元`;

            switchView(submitButton, false);
            submitButton.disabled = true;
        }

        function createTableRow(data) {
            const arr = data.map(e => {
                const nameStyle = isNaN(e) ? ' class="name"' : '';
                return `<td${nameStyle}>${e}</td>`;
            });

            return `<tr>${arr.join('')}</tr>`;
        }

        function createTable() {
            const tableRows = arrayName.map((name, i) => {
                return createTableRow([name, arrayQuantity[i], arrayPrice[i], arrayPxQ[i]]);
            });

            return `
                        <table>
                          <thead>
                            <tr>
                              <td class="name">品名</td>
                              <td>數量</td>
                              <td>單價</td>
                              <td>總價</td>
                            </tr>
                          </thead>
                          <tbody>
                            ${tableRows.join('')}
                          <tr class="final">
                              <td>合計新臺幣<span class="priceTag">${total}</span>元整</td>
                              <td colspan="3">銀貨兩訖</td>
                          </tr>
                          </tbody>
                        </table>
                      `;
        }

        function switchView(element, condition) {
            if (element.classList.contains('hidden') && condition) {
                element.classList.remove('hidden')
            }
            else if (!element.classList.contains('hidden') && !condition) {
                element.classList.add('hidden')
            }
        }

        ///

        $('#bootstrapForm').submit(function (event) {
            event.preventDefault()
            var extraData = {}
            $('#bootstrapForm').ajaxSubmit({
                data: extraData,
                dataType: 'jsonp',
                error: displayReceipt()
            })
        })

        ///

        document.addEventListener("click", (event) => {
            const target = event.target;

            if (target.classList.contains("less") || target.classList.contains("more")) {
                const input = target.closest(".quantity").querySelector("input[type='number']");
                if (!input) return;

                let currentValue = parseInt(input.value) || 0;

                if (target.classList.contains("less")) {
                    currentValue = Math.max(0, currentValue - 1);
                } else if (target.classList.contains("more")) {
                    currentValue += 1;
                }

                input.value = currentValue > 0 ? currentValue : '';

                const inputEvent = new Event("input", { bubbles: true });
                input.dispatchEvent(inputEvent);
            }
        });

        function jumpTo(divID, accID = '') {
            document.getElementById(divID).scrollIntoView();

            if (!accID)
                return;

            const acc = document.getElementById(accID);

            if (!acc.classList.contains('active'))
                acc.dispatchEvent(new Event('click'));
        }

        function resizeOpenAccordion() {
            const openAccordion = document.querySelector(".accordion-button.active");
            if (openAccordion) {
                const panel = openAccordion.nextElementSibling;
                if (panel) {
                    panel.style.maxHeight = null;
                    panel.style.maxHeight = panel.scrollHeight + "px";
                }
            }
        }

        ///

        const url = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQeHdTsL6TnBGQimkS2NQUYJ9Vr6qBQRVwLfY0TMX4XYooThZ-QuhZdqPCmFWXbL80isg7dHihOn_DI/pub?output=csv";
        let couponJsonData = localStorage.getItem("couponJsonData") || [];
        let couponJsonOutput = "";

        function csvToJson(csvString) {
            const rows = csvString.trim().split("\n");
            const headers = rows[0].split(",");
            const usedCouponsIndex = headers.findIndex(title => title.trim() === 'coaCoupon');

            if (usedCouponsIndex === -1) {
                console.error("Column 'coaCoupon' not found");
                return;
            }

            for (let i = 1; i < rows.length; i++) {
                const values = rows[i].split(",");
                const couponCode = values[usedCouponsIndex]?.trim();
                if (couponCode && !couponJsonData.includes(couponCode)) {
                    couponJsonData.push(couponCode);
                }
            }

            localStorage.setItem("couponJsonData", couponJsonData);
            couponJsonOutput = JSON.stringify(couponJsonData);
        }

        loadCoupons();

        function loadCoupons() {
            switchView(submitButton, false);
            submitButton.disabled = true;

            couponJsonOutput = "";

            const dataReady = new Promise((resolve, reject) => {
                fetch(url)
                    .then(r => r.text())
                    .then(t => {
                        csvToJson(t);
                        resolve();
                    })
                    .catch(err => reject(err));
            });

            dataReady
                .then(() => {
                    console.log(couponJsonOutput);
                    triggerValidate(document.getElementById('331688563'));
                })
                .catch(err => {
                    console.error("Failed to fetch or process data:", err);
                });
        }

        const SECRET_KEY = "SHUNGDANINGYUJHOU-";

        document.getElementById("331688563").addEventListener("input", function () {
            const input = this;
            triggerValidate(input);
        });

        function triggerValidate(input) {
            input.value = input.value.trim();
            const key = input.value;
            const isValid = validateCouponKey(key);

            if (couponJsonOutput.includes(key) && key.length != 0) {
                input.setCustomValidity("此折價券已被使用。");
                couponKeyValid = false;
            }
            else if (isValid || key.length === 0) {
                input.setCustomValidity("");
                couponKeyValid = true;
            }
            else {
                input.setCustomValidity("折價券代碼無效。");
                couponKeyValid = false;
            }

            switchView(submitButton, total > 0 && couponKeyValid);
            submitButton.disabled = total <= 0 && !couponKeyValid;

            updateTotal();
        }

        function validateCouponKey(key) {
            const regex = /^[A-Z]{3}-\d{3}-\d{4}$/;
            if (!regex.test(key)) return false;

            const param = key.split("-");
            const base = key.slice(0, key.lastIndexOf("-"));
            const checksum = param.pop();
            const num = param[1];

            return calculateChecksum(parseInt(num), base).padStart(4, '0') === checksum;
        }

        function calculateChecksum(num, base) {
            const combined = SECRET_KEY.slice(num % 17) + base;
            return combined.split("").reduce((sum, char) => sum + char.charCodeAt(0), 0).toString().slice(-4);
        }

        function useNewCoupon(key) {
            couponJsonData.push(key);
            localStorage.setItem("couponJsonData", couponJsonData);
        }
</script>
</body>
</html>
