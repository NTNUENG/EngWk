<!DOCTYPE html>
<html lang="zh-tw">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>前臺｜國立臺灣師範大學英語學系 2024 聖誕英語週點餐系統</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Mono:wdth,wght@75,100..900&display=swap" rel="stylesheet">
    <link rel="stylesheet" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/misans@4.0.0/lib/TC/MisansTC-Normal.min.css" />
    <link rel="stylesheet" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/misans@4.0.0/lib/TC/MisansTC-Bold.min.css" />
    <link rel="stylesheet" href="stylesheets/style.css">
    <link rel="stylesheet" href="stylesheets/_accordion.css">
</head>

<body>
    <div class="blurred-bg"></div>

    <form action="https://docs.google.com/forms/d/e/1FAIpQLSf-A4ReWwACpnJNrCWcpBdo2z2KgOrQSVv16Jr0RHKEY4_S2g/formResponse"
          target="_self"
          id="bootstrapForm"
          method="POST">

        <div class="header" id="top">
            <h1>聖誕英語週點餐系統前臺</h1>

            <!-- Field type: "short" id: "1028344047" -->
            <fieldset style="display: block">
                <legend for="1028344047">收銀員</legend>
                <input id="1726360308" style="width: min(calc(var(--gap) * 20), 80dvw);" type="text" name="entry.1726360308" placeholder="收銀員華文姓名" class="form-control" required>
            </fieldset>

            <div id="input-group" style=" display: flex; justify-content: center;">
                <!-- Field type: "short" id: "71287061" -->
                <fieldset>
                    <legend for="71287061">ID-num</legend>
                    <div class="form-group">
                        <input id="780771985" style="width: min(calc(var(--gap) * 10), 40dvw); border-top-right-radius: 0px; border-bottom-right-radius: 0px; clip-path: inset(-10px 0px -10px -10px);" type="tel" name="entry.780771985" placeholder="客戶末三碼" pattern="[0-9]{3}" class="form-control" required>
                    </div>
                </fieldset>


                <!-- Field type: "short" id: "762479566" -->
                <fieldset>
                    <legend for="762479566">ID-surname</legend>
                    <div class="form-group">
                        <input id="553056708" style="width: min(calc(var(--gap) * 10), 40dvw); border-top-left-radius: 0px; border-bottom-left-radius: 0px; clip-path: inset(-10px -10px -10px 0px);" type="text" name="entry.553056708" placeholder="客戶姓氏" class="form-control" required>
                    </div>
                </fieldset>
            </div>
        </div>

        <div class="container" id="ry">
            <!-- Field type: "section" id: "854395890" -->
            <fieldset style="display: block;">
                <h2 for="854395890">時間暫停熱壓吐司</h2>
            </fieldset>

            <div class="menu">
                <!-- Field type: "short" id: "788998900" -->
                <fieldset>
                    <legend for="788998900">ㄖㄧ奶酥</legend>
                    <ruby>奶酥<rt>25$</rt></ruby>
                    <input id="1293379201" type="number" name="entry.1293379201" placeholder="0" class="form-control" data-name="時間暫停熱壓吐司・奶酥" min="0" data-price="25">
                </fieldset>

                <!-- Field type: "short" id: "282590697" -->
                <fieldset>
                    <legend for="282590697">ㄖㄧ香蒜</legend>
                    <ruby>香蒜<rt>30$</rt></ruby>
                    <input id="1152234688" type="number" name="entry.1152234688" placeholder="0" class="form-control" data-name="時間暫停熱壓吐司・香蒜" min="0" data-price="30">
                </fieldset>

                <!-- Field type: "short" id: "224487495" -->
                <fieldset>
                    <legend for="224487495">ㄖㄧ巧克力</legend>
                    <ruby>巧克力棉花糖<rt>30$</rt></ruby>
                    <input id="312838004" type="number" name="entry.312838004" placeholder="0" class="form-control" data-name="時間暫停熱壓吐司・巧克力棉花糖" min="0" data-price="30">
                </fieldset>

                <!-- Field type: "short" id: "1704765215" -->
                <fieldset>
                    <legend for="1704765215">ㄖㄧ火腿</legend>
                    <ruby>火腿起司<rt>35$</rt></ruby>
                    <input id="219553379" type="number" name="entry.219553379" placeholder="0" class="form-control" data-name="時間暫停熱壓吐司・火腿起司" min="0" data-price="35">
                </fieldset>
            </div>
        </div>

        <div class="container" id="et">
            <!-- Field type: "section" id: "1082036472" -->
            <fieldset style="display: block;">
                <h2 for="1082036472">撲克牌武士小蛋糕</h2>
            </fieldset>

            <div class="menu">
                <!-- Field type: "short" id: "397234414" -->
                <fieldset>
                    <legend for="397234414">ㄧㄉOreo</legend>
                    <ruby>黑桃<span class="hanLatin">♠️</span><sub>Oreo</sub><rt>35$</rt></ruby>
                    <input id="2110937824" type="number" name="entry.2110937824" placeholder="0" class="form-control" data-name="撲克牌武士小蛋糕・黑桃武士" min="0" data-price="35">
                </fieldset>

                <!-- Field type: "short" id: "924501392" -->
                <fieldset>
                    <legend for="924501392">ㄧㄉ草莓</legend>
                    <ruby>紅心<span class="hanLatin">♥️</span><sub>草莓果醬＋果乾</sub><rt>40$</rt></ruby>
                    <input id="2078319371" type="number" name="entry.2078319371" placeholder="0" class="form-control" data-name="撲克牌武士小蛋糕・紅心武士" min="0" data-price="40">
                </fieldset>

                <!-- Field type: "short" id: "1436610486" -->
                <fieldset>
                    <legend for="1436610486">ㄧㄉ巧克力</legend>
                    <ruby>方塊<span class="hanLatin">♦️</span><sub>巧克力醬＋棉花糖</sub><rt>35$</rt></ruby>
                    <input id="476499688" type="number" name="entry.476499688" placeholder="0" class="form-control" data-name="撲克牌武士小蛋糕・方塊武士" min="0" data-price="35">
                </fieldset>

                <!-- Field type: "short" id: "1608265025" -->
                <fieldset>
                    <legend for="1608265025">ㄧㄉ抹茶</legend>
                    <ruby>梅花<span class="hanLatin">♣️</span><sub>抹茶紅豆</sub><rt>40$</rt></ruby>
                    <input id="1432997229" type="number" name="entry.1432997229" placeholder="0" class="form-control" data-name="撲克牌武士小蛋糕・梅花武士" min="0" data-price="40">
                </fieldset>
            </div>
        </div>

        <div class="container" id="dr">
            <!-- Field type: "section" id: "1720670259" -->
            <fieldset style="display: block;">
                <h2 for="1720670259">飲品</h2>
            </fieldset>

            <div class="menu">
                <!-- Field type: "short" id: "146021213" -->
                <fieldset>
                    <legend for="146021213">ㄧㄌ可可</legend>
                    <ruby>瘋帽客可可<rt>30$</rt></ruby>
                    <input id="576114498" type="number" name="entry.576114498" placeholder="0" class="form-control" data-name="飲品・瘋帽客可可" min="0" data-price="30">
                </fieldset>

                <!-- Field type: "short" id: "528786601" -->
                <fieldset>
                    <legend for="528786601">ㄧㄌ棉花糖</legend>
                    <ruby>瘋帽客可可<sub>＋棉花糖</sub><rt>35$</rt></ruby>
                    <input id="1436805870" type="number" name="entry.1436805870" placeholder="0" class="form-control" data-name="飲品・瘋帽客可可＋" min="0" data-price="35">
                </fieldset>

                <!-- Field type: "short" id: "301739864" -->
                <fieldset>
                    <legend for="301739864">ㄧㄌ奶茶</legend>
                    <ruby>白兔奶茶<rt>30$</rt></ruby>
                    <input id="362036548" type="number" name="entry.362036548" placeholder="0" class="form-control" data-name="飲品・白兔奶茶" min="0" data-price="30">
                </fieldset>

                <!-- Field type: "short" id: "506716195" -->
                <fieldset>
                    <legend for="506716195">ㄧㄌ咖啡</legend>
                    <ruby>苦澀寫字檯<rt>30$</rt></ruby>
                    <input id="3695229" type="number" name="entry.3695229" placeholder="0" class="form-control" data-name="飲品・苦澀寫字檯咖啡" min="0" data-price="30">
                </fieldset>

                <!-- Field type: "short" id: "1721585757" -->
                <fieldset>
                    <legend for="1721585757">ㄧㄌ紅茶</legend>
                    <ruby>紅心皇后皇家紅茶<rt>30$</rt></ruby>
                    <input id="263894104" type="number" name="entry.263894104" placeholder="0" class="form-control" data-name="飲品・紅心皇后皇家紅茶" min="0" data-price="30">
                </fieldset>

                <!-- Field type: "short" id: "607958717" -->
                <fieldset>
                    <legend for="607958717">ㄧㄌ蘑菇</legend>
                    <ruby>艾瑟隆迷幻蘑菇濃湯<rt>45$</rt></ruby>
                    <input id="22730490" type="number" name="entry.22730490" placeholder="0" class="form-control" data-name="飲品・艾瑟隆迷幻蘑菇濃湯" min="0" data-price="45">
                </fieldset>
            </div>
        </div>

        <div class="container">
            <!-- Field type: "section" id: "525883564" -->
            <fieldset style="display: block;">
                <h2 for="525883564">美宣品</h2>
            </fieldset>

            <div class="menu">
                <!-- Field type: "short" id: "930259876" -->
                <fieldset>
                    <legend for="930259876">ㄇㄒ貼紙</legend>
                    <ruby>貼紙<rt>15$</rt></ruby>
                    <input id="1485386383" type="number" name="entry.1485386383" placeholder="0" class="form-control" data-name="美宣品・貼紙" min="0" data-price="15">
                </fieldset>

                <!-- Field type: "short" id: "1392899267" -->
                <fieldset>
                    <legend for="1392899267">ㄇㄒ徽章</legend>
                    <ruby>徽章<rt>40$</rt></ruby>
                    <input id="1529285761" type="number" name="entry.1529285761" placeholder="0" class="form-control" data-name="美宣品・徽章" min="0" data-price="40">
                </fieldset>

                <!-- Field type: "short" id: "261692789" -->
                <fieldset>
                    <legend for="261692789">ㄇㄒ明信片</legend>
                    <ruby>明信片<rt>40$</rt></ruby>
                    <input id="1866350321" type="number" name="entry.1866350321" placeholder="0" class="form-control" data-name="美宣品・明信片" min="0" data-price="40">
                </fieldset>

                <!-- Field type: "short" id: "407652816" -->
                <fieldset>
                    <legend for="407652816">ㄇㄒ吊飾</legend>
                    <ruby>吊飾<rt>45$</rt></ruby>
                    <input id="1631742395" type="number" name="entry.1631742395" placeholder="0" class="form-control" data-name="美宣品・吊飾" min="0" data-price="45">
                </fieldset>

                <!-- Field type: "short" id: "1063157919" -->
                <fieldset>
                    <legend for="1063157919">ㄇㄒ檔案夾</legend>
                    <ruby>資料夾<rt>55$</rt></ruby>
                    <input id="729785754" type="number" name="entry.729785754" placeholder="0" class="form-control" data-name="美宣品・資料夾" min="0" data-price="55">
                </fieldset>


                <!-- Field type: "short" id: "481329278" -->
                <fieldset>
                    <legend for="481329278">ㄇㄒ系服</legend>
                    <ruby>系服<rt>340$</rt></ruby>
                    <input id="262762365" type="number" name="entry.262762365" placeholder="0" class="form-control" data-name="美宣品・系服" min="0" data-price="340">
                </fieldset>
            </div>
        </div>

        <input type="hidden" name="fvv" value="1">
        <input type="hidden" name="fbzx" value="-7408342391169980571">
        <!--
            CAVEAT: In multipages (multisection) forms, *pageHistory* field tells to google what sections we've currently completed.
            This usually starts as "0" for the first page, then "0,1" in the second page... up to "0,1,2..N" in n-th page.
            Keep this in mind if you plan to change this code to recreate any sort of multipage-feature in your exported form.
            We're setting this to the total number of pages in this form because we're sending all fields from all the section together.
        -->
        <input type="hidden" name="pageHistory" value="0,1,2,3,4">

        <div class="container fullscreen flex">
            <h2 for="525883564">優惠方案</h2>
            <div class="accordion">
                <!-- Accordion Item 1 -->
                <div class="accordion-item">
                    <button class="accordion-button" type="button">套餐</button>
                    <div class="accordion-panel">
                        <div class="accordion-body">
                            凡購買「時間暫停熱壓吐司」或「撲克牌武士小蛋糕」搭配「飲品」者，折<span class="hanLatin">5</span>元。
                        </div>
                    </div>
                </div>
                <!-- Accordion Item 2 -->
                <div class="accordion-item">
                    <button class="accordion-button" type="button">打卡</button>
                    <div class="accordion-panel">
                        <div class="accordion-body">
                            消費並打卡「@英語週帳號 #喝我 #吃我 #英語週slogan」即享有「轉盤」機會乙次。
                        </div>
                    </div>
                </div>
                <!-- Accordion Item 3 -->
                <div class="accordion-item">
                    <button class="accordion-button" type="button">遊戲</button>
                    <div class="accordion-panel">
                        <div class="accordion-body">
                            消費滿百即享有遊戲機會。
                            <div style="display: flex; flex-direction: row; margin-top: 1em">
                                <div style="flex: 1 1 auto; padding: calc(var(--gap) * 0.5);">
                                    <p><strong>紅心皇后的槌球場</strong></p>
                                    <p style="font-size: 80%;">每單以乙次為限，擲乒乓球入杯中即可獲得杯底所示獎勵。未投進者不予重試。</p>
                                </div>
                                <div style="flex: 1 1 auto; padding: calc(var(--gap) * 0.5);">
                                    <p><strong>紅心背叛者</strong></p>
                                    <p style="font-size: 80%;">消費滿百起每<span class="hanLatin">10</span>元多乙次機會，自牌堆中抽牌並抽獲鬼牌者贈送公關品或折扣。</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div style="flex: 1 1 auto"></div>
            <div class="centre">
                <div id="total" style="font-size: 2em; font-weight: bold">總金額：0 元</div>
                <input class="btn" type="button" value="重新" onclick="resetInputs()" style="background: #ffdad6;color: #410002;font-weight: bold;">
                <input class="btn" type="submit" value="提交" id="submit-button" style="background: #ddea96;color: #191e00;font-weight: bold;" disabled>
            </div>
        </div>

        <div class="container receipt" id="receipt">
            <h2>收據</h2>
            <div id="recipient" class="orderID"><span class="hanLatin"></span><span id="receipt-time"></span></div>
            <div id="receipt-table">
            </div>
            <div id="total-receipt"></div>
        </div>
    </form>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.form/4.2.2/jquery.form.min.js" integrity="sha256-2Pjr1OlpZMY6qesJM68t2v39t+lMLvxwpa8QlRjJroA=" crossorigin="anonymous"></script>
    <script src="js/_accordion.js"></script>
    <script>
        const form = document.getElementById('bootstrapForm');
        const totalElement = document.getElementById('total');
        const submitButton = document.getElementById('submit-button');
        const receipt = document.getElementById('receipt');
        const receiptItems = document.getElementById('receipt-table');
        const totalReceipt = document.getElementById('total-receipt');

        form.addEventListener('input', updateTotal);

        let arrayName = new Array();
        let arrayQuantity = new Array();
        let arrayPrice = new Array();
        let arrayPxQ = new Array();

        let total = 0;
        let boughtRuhyah = 0;
        let boughtEton = 0;
        let boughtDrinks = 0;
        let discountA = 0;
        let discountB = 0;

        resetVariables();

        function resetVariables() {
            receipt.style.display = 'none';
            receiptItems.innerHTML = '';
            arrayName = new Array();
            arrayQuantity = new Array();
            arrayPrice = new Array();
            arrayPxQ = new Array();
            total = 0;
            boughtRuhyah = 0;
            boughtEton = 0;
            boughtDrinks = 0;
            discountA = 0;
            discountB = 0;
            updateTotal();
        }

        function resetInputs() {
            document.getElementById('top').scrollIntoView({ behavior: 'smooth' });

            form.querySelectorAll('input[type="number"]').forEach(input => {
                input.value = '';
            });
            document.getElementById('780771985').value = '';
            document.getElementById('553056708').value = '';
            resetVariables();
        }

        function countDiscountSet(type) {
            let discountTimes = 0;
            const inputs = form.querySelectorAll(`#${type} input[type="number"]`);
            inputs.forEach(input => {
                const quantity = input.value || 0;
                if (quantity > 0) {
                    discountTimes += parseInt(quantity);
                }
            });
            return discountTimes;
        }

        function updateTotal() {
            total = 0;
            boughtRuhyah = countDiscountSet('ry');
            boughtEton = countDiscountSet('et');
            boughtDrinks = countDiscountSet('dr');
            discountA = Math.min(boughtRuhyah, boughtDrinks);
            boughtDrinks -= discountA;
            discountB = Math.min(boughtEton, boughtDrinks);

            const inputs = form.querySelectorAll('input[type="number"]');
            inputs.forEach(input => {
                const quantity = input.value || 0;
                if (quantity > 0) {
                    const name = input.dataset.name;
                    const price = input.dataset.price;
                    total += price * quantity;
                }
            });

            if (discountA > 0) {
                total += discountA * -5;
            }

            if (discountB > 0) {
                total += discountB * -5;
            }

            totalElement.innerHTML = `共<span class="priceTag">${total}</span>元`;
            submitButton.style.display = total > 0 ? 'block' : 'none';
            submitButton.disabled = total <= 0;
        }

        function displayReceipt() {
            resetVariables();
            console.log(total);

            const inputs = form.querySelectorAll('input[type="number"]');
            inputs.forEach(input => {
                const quantity = parseInt(input.value) || 0;
                if (quantity > 0) {
                    const name = input.dataset.name;
                    const price = parseInt(input.dataset.price);

                    arrayName.push(name);
                    arrayQuantity.push(quantity);
                    arrayPrice.push(price);
                    arrayPxQ.push(price * quantity);
                }
            });

            let discountAB = discountA + discountB;

            if (discountAB > 0) {
                arrayName.push('優惠方案・套餐');
                arrayQuantity.push(discountAB);
                arrayPrice.push(-5);
                arrayPxQ.push(discountAB * -5);
            }

            document.getElementById('recipient').innerHTML = `＃<span class="hanLatin" style="padding-left: 0;">${document.getElementById('780771985').value}</span>${document.getElementById('553056708').value}｜<span id="receipt-time"></span>`

            const date = new Date();
            const youbi = ['日', '一', '二', '三', '四', '五', '六'];
            document.getElementById('receipt-time').innerHTML = `中華民國<span class="hanLatin">${date.getFullYear() - 1911}</span>年<span class="hanLatin">${date.getMonth() + 1}</span>月<span class="hanLatin">${date.getDate()}</span>日<span class="hanLatin">${date.getHours()}</span>時<span class="hanLatin">${date.getMinutes()}</span>分<span class="hanLatin">${date.getSeconds()}</span>秒｜${document.getElementById('1726360308').value}`;

            receiptItems.insertAdjacentHTML('afterbegin', createTable());
            receipt.style.display = 'block';
            receipt.scrollIntoView({ behavior: 'smooth' });

            //totalElement.textContent = `總金額：0 元`;
        }

        function createTableRow(data) {
            const arr = data.map(e => {
                const nameStyle = isNaN(e) ? ' class="name"' : '';
                return `<td${nameStyle}>${e}</td>`;
            });

            return `<tr>${arr.join('')}</tr>`;
        }

        function createTable() {
            const tableRows = arrayName.map((name, i) => {
                return createTableRow([name, arrayQuantity[i], arrayPrice[i], arrayPxQ[i]]);
            });

            return `
                <table>
                  <thead>
                    <tr>
                      <td class="name">品名</td>
                      <td>數量</td>
                      <td>單價</td>
                      <td>總價</td>
                    </tr>
                  </thead>
                  <tbody>
                    ${tableRows.join('')}
                  <tr class="final">
                      <td>合計新臺幣<span class="priceTag">${total}</span>元整</td>
                      <td colspan="3">銀貨兩訖</td>
                  </tr>
                  </tbody>
                </table>
              `;
        }

        $('#bootstrapForm').submit(function (event) {
            event.preventDefault()
            var extraData = {}
            $('#bootstrapForm').ajaxSubmit({
                data: extraData,
                dataType: 'jsonp',
                error: displayReceipt()
            })
        })</script>
</body>
</html>
